var path = require('path');
var fs = require('fs');
var lib = path.join(path.dirname(fs.realpathSync(__filename)), '../lib');
var simple = require(lib + '/simple_math.js');
var advanced = require(lib + '/advanced_math.js');
module.exports = {
    addition: simple.addition,
    subtraction: simple.subtraction,
    multiplication: advanced.multiplication,
    division: advanced.division,
    fibonacci: advanced.fibonacci
}
var math = require('mymath');

var express = require('express');
var app = express();
var formidable = require('formidable');

var path = __dirname + '/public';
app.use(express.static(path));
console.log("path: " + path);

app.post('/SubmitHelloPost', function (request, response) {
    if (request.method.toLowerCase() == 'post') {
        // parse form data
        var form = new formidable.IncomingForm();
        form.parse(request, function (err, fields) {
            response.writeHead(200, { 'Content-Type': 'text/html' });
            response.write('Hello ' + fields.userName + '!<br />');
            response.end('Have a POST great day!');
            console.log('Handled request from ' + fields.userName);
        });
    }
});

app.get('/SubmitHello', function (request, response) {
    response.writeHead(200, { 'Content-Type': 'text/html' });
    response.write('Hello ' + request.query.userName + '!<br />');
    response.end('Have a great day!');
    console.log('Handled request from ' + request.query.userName);
});

app.get('/Addition', function (request, response) {
    var x = Number(request.query.x),
        y = Number(request.query.y),
        result = math.addition(x, y);
    response.writeHead(200, { 'Content-Type': 'application/json' });
    response.end('{ "result": ' + result + '}');
    console.log('Handled addition request for x=' + x + ' : y=' + y);
});
var port = 8080;
app.listen(port);
console.log('Listening on port (from app.js): ' + port);